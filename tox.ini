[tox]
minversion = 4.0.0
envlist = py311, py312, py313, lint, mypy
isolated_build = True

[gh-actions]
python =
    3.11: py311
    3.12: py312
    3.13: py313

[testenv]
description = Run tests with pytest
deps =
    pytest>=8.0.0
    pytest-cov>=6.0.0
    pytest-mypy>=1.0.0
    pytest-xdist>=3.0.0
setenv =
    PYTHONPATH = {toxinidir}
commands =
    pytest {posargs:tests}

[testenv:lint]
description = Run linting checks
deps =
    black>=25.1.0
    isort>=6.0.0
    flake8>=7.2.0
    flake8-docstrings>=1.7.0
    flake8-import-order>=0.18.2
    autoflake8>=0.4.0
commands =
    black --check ziggiz_courier_handler_core tests
    isort --profile=black --check ziggiz_courier_handler_core tests
    flake8 --config=.flake8 ziggiz_courier_handler_core tests

[testenv:mypy]
description = Run type checks with mypy
deps =
    mypy>=1.15.0
    types-setuptools
    types-xmltodict
commands =
    mypy ziggiz_courier_handler_core tests

[testenv:format]
description = Format code with black and isort
deps =
    black>=25.1.0
    isort>=6.0.0
    autoflake8>=0.4.0
commands =
    isort ziggiz_courier_handler_core tests
    black ziggiz_courier_handler_core tests
    autoflake8 --in-place --remove-unused-variables --remove-all-unused-imports --recursive ziggiz_courier_handler_core tests

[flake8]
max-line-length = 88
extend-ignore = E203
exclude = .git,__pycache__,build,dist
per-file-ignores =
    __init__.py: F401

[pytest]
testpaths = tests
markers =
    unit: Unit tests that test a single component in isolation
    integration: Tests that verify multiple components working together
    rfc3164: Tests related to RFC3164 parser functionality
    rfc5424: Tests related to RFC5424 parser functionality
    pri_only: Tests for PRI-only messages
    factory: Tests involving the parser factory
